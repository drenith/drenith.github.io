<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<script>

const furnishing_xp = [
	100,
	215,
	345,
	490,
	650,
	825,
	1015,
	1220,
	1440,
	1675,
	1925,
	2190,
	2470,
	2765,
	3075,
	3400,
	3740,
	4095,
	4465,
	4850,
	5250,
	5665,
	6095,
	6540,
	7000,
	7475,
	7965,
	8470,
	8990,
	9525,
	10075,
	10640,
	11220,
	11815,
	12425,
	13050,
	13690,
	14345,
	15015,
	15700,
	16400,
	17115,
	17845,
	18590,
	19350,
	20125,
	20915,
	21720,
	22540,
	23375,
	24575,
	25855,
	27215,
	28655,
	30175,
	31775,
	33455,
	35215,
	37055,
	38975,
	40975,
	43055,
	45215,
	47455,
	49775,
	52175,
	54655,
	57215,
	59855,
	62575,
	65375,
	68255,
	71215,
	74255,
	77375,
	80575,
	83855,
	87215,
	90655,
	94175,
	97775,
	101455,
	105215,
	109055,
	112975,
	116975,
	121055,
	125215,
	129455,
	133775,
	138175,
	142655,
	147215,
	151855,
	156575,
	161375,
	166255,
	171215,
	176255,
	181375,
	190975,
	201055,
	211615,
	222655,
	234175,
	246175,
	258655,
	271615,
	285055,
	298975,
	313375,
	328255,
	343615,
	359455,
	375775,
	392575,
	409855,
	427615,
	445855,
	464575,
	483775,
	503455,
	523615,
	544255,
	565375,
	586975,
	609055,
	631615,
	654655,
	678175,
	702175,
	726655,
	751615,
	777055,
	802975,
	829375,
	856255,
	883615,
	911455,
	939775,
	968575,
	997855,
	1027615,
	1057855,
	1088575,
	1119775,
	1151455,
	1183615,
	1216255,
	1249375,
	1319775,
	1392735,
	1468255,
	1546335,
	1626975,
	1710175,
	1795935,
	1884255,
	1975135,
	2068575,
	2164575,
	2263135,
	2364255,
	2467935,
	2574175,
	2682975,
	2794335,
	2908255,
	3024735,
	3143775,
	3265375,
	3389535,
	3516255,
	3645535,
	3777375,
	3911775,
	4048735,
	4188255,
	4330335,
	4474975,
	4622175,
	4771935,
	4924255,
	5079135,
	5236575,
	5396575,
	5559135,
	5724255,
	5891935,
	6062175,
	6234975,
	6410335,
	6588255,
	6768735,
	6951775,
	7137375,
	7325535,
	7516255,
	7709535,
	7905375
]

const xp_table = [
	100,
	205,
	315,
	430,
	550,
	675,
	805,
	940,
	1080,
	1225,
	1375,
	1530,
	1690,
	1855,
	2025,
	2200,
	2380,
	2565,
	2755,
	2950,
	3150,
	3355,
	3565,
	3780,
	4000,
	4225,
	4455,
	4690,
	4930,
	5175,
	5425,
	5680,
	5940,
	6205,
	6475,
	6750,
	7030,
	7315,
	7605,
	7900,
	8200,
	8505,
	8815,
	9130,
	9450,
	9775,
	10105,
	10440,
	10780,
	11125,
	11625,
	12175,
	12775,
	13425,
	14125,
	14875,
	15675,
	16525,
	17425,
	18375,
	19375,
	20425,
	21525,
	22675,
	23875,
	25125,
	26425,
	27775,
	29175,
	30625,
	32125,
	33675,
	35275,
	36925,
	38625,
	40375,
	42175,
	44025,
	45925,
	47875,
	49875,
	51925,
	54025,
	56175,
	58375,
	60625,
	62925,
	65275,
	67675,
	70125,
	72625,
	75175,
	77775,
	80425,
	83125,
	85875,
	88675,
	91525,
	94425,
	97375,
	100909,
	104629,
	108535,
	112627,
	116905,
	121369,
	126019,
	130855,
	135877,
	141085,
	146479,
	152059,
	157825,
	163777,
	169915,
	176239,
	182749,
	189445,
	196327,
	203395,
	210649,
	218089,
	225715,
	233527,
	241525,
	249709,
	258079,
	266635,
	275377,
	284305,
	293419,
	302719,
	312205,
	321877,
	331735,
	341779,
	352009,
	362425,
	373027,
	383815,
	394789,
	405949,
	417295,
	428827,
	440545,
	452449,
	464539,
	476815,
	489277,
	501925,
	514325,
	527345,
	540985,
	555245,
	570125,
	585625,
	601745,
	618485,
	635845,
	653825,
	672425,
	691645,
	711485,
	731945,
	753025,
	774725,
	797045,
	819985,
	843545,
	867725,
	892525,
	917945,
	943985,
	970645,
	997925,
	1025825,
	1054345,
	1083485,
	1113245,
	1143625,
	1174625,
	1206245,
	1238485,
	1271345,
	1304825,
	1338925,
	1373645,
	1408985,
	1444945,
	1481525,
	1518725,
	1556545,
	1594985,
	1634045,
	1673725,
	1714025,
	1754945,
	1796485,
	1838645,
	1881425
]

var materials = {
	"infused silk gloves": {
		"infused silk": 4,
		"coarse leather": 4,
		"iron ingot": 1,
		"armoring xp": 1395
	},
	"coarse leather shirt": {
		"coarse leather": 22,
		"linen": 12,
		"iron ingot": 1,
		"armoring xp": 420
	},
	"infused silk": {
		"weaving xp": 8470,
		"wirefiber": 8,
		"silk": 2,
		"cloth weave": 1
	},
	"silk": {
		"silk threads": 6,
		"sateen": 2,
		"cloth weave": 1,
		"weaving xp": 1665
	},
	"sateen": {
		"linen": 4,
		"cloth weave": 1,
		"weaving xp": 190
	},
	"oric helm": {
		"oric ingot": 8,
		"linen": 6,
		"coarse leather": 4,
		"armoring xp": 2790
	},
	"oric ingot" : {
		"flux": 1,
		"oric ore": 8,
		"starmetal ingot": 2,
		"charcoal": 2,
		"smelting xp": 10010
	},
	"starmetal ingot": {
		"starmetal ore": 6,
		"steel ingot": 2,
		"flux": 1,
		"charcoal": 2,
		"smelting xp": 2035
	},
	"steel ingot": {
		"iron ingot": 3,
		"flux": 1,
		"charcoal": 2,
		"smelting xp": 228
	},
	"iron ingot": {
		"iron ore": 4,
		"smelting xp": 36
	},	
	"charcoal": {
		"green wood": 2,
		"smelting xp": 18
	},
	"linen": {
		"fiber": 4,
		"weaving xp": 36
	},
	"coarse leather": {
		"rawhide": 4,
		"tanning xp": 36
	},
	"cot": {
		"feather": 1,
		"maple stain": 2,
		"furnishing xp": 24
	},
	"maple stain": {
		"weak solvent": 1,
		"oil": 0.4,
		"furnishing xp": 8.4
	},
	"oak stain": {
		"potent solvent": 10,
		"oil": 4,
		"furnishing xp": 336
	},
	"mahogany stain": {
		"pure solvent": 10,
		"oil": 4,
		"furnishing xp": 1344
	},
	"oric setting": {
		"oric ingot": 4,
		"jewelry xp": 208
	},
	"pristine jewelry": {
		"cut pristine gem": 1,
		"silver chain": 1,
		"silver setting": 1,
		"silver ingot": 1,
		"jewelry xp": 2000
	},
	"silver chain": {
		"silver ingot": 5,
		"jewelry xp": 15
	},
	"silver setting": {
		"silver ingot": 4,
		"jewelry xp": 12
	},
	"silver ingot": {
		"silver ore": 4,
		"smelting xp": 36
	},
	"cut pristine gem": {
		"pristine gem": 1,
		"quintessence": 3
	},
	"iron spear": {
		"timber": 10,
		"iron ingot": 5,
		"coarse leather": 2,
		"engineering xp": 204
	},
	"orichalcum spear": {
		"ironwood planks": 13,
		"iron ingot": 5,
		"coarse leather": 2,
		"engineering xp": 3100
	},
	"ironwood planks": {
		"ironwood": 8,
		"wyrdwood planks": 2,
		"sandpaper": 1,
		"woodworking xp": 8470
	},
	"wyrdwood planks": {
		"wyrdwood": 6,
		"lumber": 2,
		"sandpaper": 1,
		"woodworking xp": 1665
	},
	"lumber": {
		"aged wood": 4,
		"timber": 2,
		"sandpaper": 1,
		"woodworking xp": 266
	},
	"timber": {
		"green wood": 4,
		"woodworking xp": 36
	},
	"weak honing stone": {
		"stone block": 1,
		"death mote": 1,
		"fire mote": 1,
		"weaponsmithing xp": 36
	},
	"infused health potion": {
		"azoth water": 1,
		"earth mote": 1,
		"soul mote": 1,
		"water": 1,
		"arcana xp": 620
	},
	"tree stump side table": {
		"lumber": 35,
		"weak solvent": 10,
		"maple stain": 2,
		"furnishing xp": 1128
	},
	"iron longsword": {
		"iron ingot": 7,
		"timber": 2,
		"coarse leather": 1,
		"weaponsmithing xp": 120
	},
	"rugged leather": {
		"coarse leather": 4,
		"tannin": 1,
		"leatherworking xp": 190
	},	
	"layered leather": {
		"iron hide": 8,
		"layered leather": 2,
		"tannin": 1,
		"leatherworking xp": 8470
	},	
	"infused leather": {
		"thick hide": 6,
		"rugged leather": 2,
		"tannin": 1,
		"leatherworking xp": 1665
	},
	"runic leather": {
		"infused leather": 5,
		"smolderhide": 1,
		"scarhide": 1,
		"aged tannin": 1
	},
	"asmodeum ingot": {
		"oric ingot": 5,
		"cinnabar": 1,
		"tolvium": 1,
		"obsidian flux": 1
	},
	"phoenixweave": {
		"infused silk": 5,
		"scalecloth": 1,
		"blisterweave": 1,
		"wireweave": 1
	},
	"600 gs bag": {
		"runic leather": 45,
		"phoenixweave": 15,
		"asmodeum ingot": 10
	}	
}

function calc(quant, mat) {
	let total = {};
	let components = materials[mat];
	for(let i=0; i < quant; i++) {
		for (const [name, count] of Object.entries(components)) {
			if(materials[name]) {
				total = merge(total, calc(count, name));
			} else {
				total[name] = total[name] ? total[name] += count : count;
			}
		}
	}
	return total;
}

function merge(a, b) {
	let total = {};
	for (const [name, count] of Object.entries(a)) {
		total[name] = total[name] ? total[name] += count : count;
	}
	for (const [name, count] of Object.entries(b)) {
		total[name] = total[name] ? total[name] += count : count;
	}
	return total;
}

function sortByValue(a, b) {
	return b[1] - a[1];
}

function prettyPrint(json) {
	let xp = Object.entries(json)
		.filter(entry => entry[0].includes("xp"))
		.sort(sortByValue);
		
	let mats = Object.entries(json)
		.filter(entry => !entry[0].includes("xp"))
		.sort(sortByValue);

	let str = [];

	for(const [name, count] of xp) {
		str.push(name + ": " + count.toLocaleString());
	}
	
	str.push("");
	
	for(const [name, count] of mats) {
		str.push(name + ": " + count.toLocaleString());
	}
	
	return str.join("\n");
}

function updateXPSelect() {
	let xpType = document.getElementById("type");
	xpType.innerHTML = '';

	let materialList = Object.values(materials)
		.map(e => Object.keys(e))
		.reduce((acc, a) => {
			a.forEach(e => acc.add(e));
			return acc;
		}, new Set());
		
	let xpTypes = [...materialList]
		.filter(e => e.endsWith("xp"))
		.forEach(element => {
			let option = document.createElement('option');
			option.value = element.replace(" xp", "");
			option.innerHTML = element.replace(" xp", "");
			xpType.appendChild(option);		
		});	
}

function updateItemSelect() {
	let xpType = document.getElementById("type").value + " xp";
	
	let itemList = document.getElementById("item");
	
	itemList.innerHTML = "";
	Object.entries(materials).filter(entry => !!entry[1][xpType]).map(entry => entry[0]).forEach(element => {
		let option = document.createElement('option');
		option.value = element;
		option.innerHTML = element;
		itemList.appendChild(option);
	});
}

function updateItemToCraft() {
	let itemList = document.getElementById('item_to_craft');
	Object.keys(materials).sort().forEach(element => {
		let option = document.createElement('option');
		option.value = element;
		option.innerHTML = element;
		itemList.appendChild(option);
	});
}

document.addEventListener("DOMContentLoaded", function(event) {
	updateXPSelect();
	updateItemSelect();
	
	document.getElementById("type").addEventListener("change", updateItemSelect);

	document.getElementById("submit").addEventListener("click", function() {
		let item_to_craft = document.getElementById("item").value;
	
		let currentLevel = document.getElementById("level").value;
		let targetLevel = document.getElementById("level_target").value;
		
		let type = document.getElementById("type").value;
		console.log("type: " + type);
		
		let xpNeeded;
		if(type === "furnishing") {
			xpNeeded = furnishing_xp[targetLevel - 1] - furnishing_xp[currentLevel - 1];
		} else {
			xpNeeded = xp_table[targetLevel - 1] - xp_table[currentLevel - 1];
		}
		
		let count = Math.ceil(xpNeeded / materials[item_to_craft][type + " xp"]);
		document.getElementById("results").textContent = "count: " + count.toLocaleString() + "\n" + prettyPrint(calc(count, item_to_craft));;
	});
	
	updateItemToCraft();
	document.getElementById('submit2').addEventListener('click', function() {
		let item_to_craft = document.getElementById('item_to_craft').value;		
		let quantity = document.getElementById('quantity').value;		
		
		document.getElementById('results2').textContent = prettyPrint(calc(quantity, item_to_craft));
	});
});
		</script>
	</head>
	<body>
		<table>
			<tr>
				<td>
					XP Type:
				</td>
				<td>
					<select id="type">
					</select>
				</td>
			</tr>		
			<tr>
				<td>
					Item to Craft:
				</td>
				<td>
					<select id="item">
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Current Level:
				</td>
				<td>
					<input type="number" min="1" max="200" id="level"/>
				</td>
			</tr>
			<tr>
				<td>
					Target Level:
				</td>
				<td>
					<input type="number" min="1" max="200" id="level_target" value="200"/>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<button id="submit">Calculate</button>
				</td>
			</tr>
		</table>
		<br>
		<pre id="results"></pre>
		<table>
			<tr>
				<td>
					Item to Craft:
				</td>
				<td>
					<select id="item_to_craft">
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Quantity:
				</td>
				<td>
					<input type="number" min="1" max="100000" id="quantity"/>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<button id="submit2">Calculate</button>
				</td>
			</tr>			
		</table>
		<pre id="results2"></pre>
	</body>
</html>